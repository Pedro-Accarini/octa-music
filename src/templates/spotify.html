{% extends 'main.html' %}
{% block title %}Spotify & YouTube Artist Metrics{% endblock %}
{% block content %}
<!-- Hero Section -->
<div class="hero-section">
  <div class="hero-content">
    <h1 class="hero-title">ğŸµ Discover Music Statistics</h1>
    <p class="hero-subtitle">Search for your favorite artists on Spotify and YouTube to explore their stats, popularity, and more.</p>
  </div>
</div>

<div class="main-flex">
  <div class="container search-box">
    <h2 class="search-title">
      <span class="search-icon">ğŸ§</span>
      Spotify
    </h2>
    <p class="search-description">Find artist follower counts, popularity scores, and genres</p>
    <form action="/" method="post" onsubmit="showLoading('spotify-loading')" role="search" aria-label="Search for Spotify artist">
      <div class="input-with-icon">
        <span class="input-icon">ğŸ”</span>
        <input name="artist_name" placeholder="Search for an artist..." autocomplete="off" required aria-label="Artist name" aria-required="true">
      </div>
      <button type="submit" name="action" value="spotify">
        <span>Search</span>
      </button>
    </form>
    <div id="spotify-loading" class="loading-spinner" style="display: none;">
      <div class="spinner"></div>
      <p>Searching...</p>
    </div>
    {% if artist %}
      <div class="artist-card fade-in">
        {% if artist.image_url %}
          <img class="artist-img" src="{{ artist.image_url }}" alt="Image of {{ artist.name }}" loading="lazy">
        {% endif %}
        <div class="artist-name">{{ artist.name }}</div>
        <div class="artist-info"><strong>Followers:</strong> {{ artist.followers }}</div>
        <div class="artist-info"><strong>Popularity:</strong> {{ artist.popularity }}/100</div>
        {% if artist.genres %}
          <div class="artist-info"><strong>Genres:</strong> {{ artist.genres }}</div>
        {% endif %}
        {% if artist.spotify_url %}
          <a class="artist-link" href="{{ artist.spotify_url }}" target="_blank" rel="noopener noreferrer">
            ğŸµ Open in Spotify
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
  <div class="container search-box">
    <h2 class="search-title youtube-title">
      <span class="search-icon">ğŸ“º</span>
      YouTube
    </h2>
    <p class="search-description">Discover channel subscriber counts, views, and video statistics</p>
    <form method="post" action="/" onsubmit="showLoading('youtube-loading')" role="search" aria-label="Search for YouTube channel">
      <div class="input-with-icon">
        <span class="input-icon">ğŸ”</span>
        <input type="text" name="channel_name" placeholder="Search for a channel..." required aria-label="Channel name" autocomplete="off" aria-required="true">
      </div>
      <button type="submit" name="action" value="youtube">
        <span>Search</span>
      </button>
    </form>
    <div id="youtube-loading" class="loading-spinner" style="display: none;">
      <div class="spinner"></div>
      <p>Searching...</p>
    </div>
    {% if yt_stats %}
      <div class="artist-card fade-in">
        {% if yt_stats.image_url %}
          <img class="artist-img" src="{{ yt_stats.image_url }}" alt="Image of channel {{ yt_stats.title }}" loading="lazy">
        {% endif %}
        <div class="artist-name">{{ yt_stats.title }}</div>
        {% if yt_stats.description %}
          <div class="artist-info description-text">{{ yt_stats.description[:150] }}{% if yt_stats.description|length > 150 %}...{% endif %}</div>
        {% endif %}
        <div class="artist-info"><strong>Subscribers:</strong> {{ "{:,}".format(yt_stats.subscribers|int) if yt_stats.subscribers else 'Hidden' }}</div>
        <div class="artist-info"><strong>Views:</strong> {{ "{:,}".format(yt_stats.views|int) if yt_stats.views else 'N/A' }}</div>
        <div class="artist-info"><strong>Video Count:</strong> {{ "{:,}".format(yt_stats.video_count|int) if yt_stats.video_count else 'N/A' }}</div>
        {% if yt_stats.channel_url %}
          <a class="artist-link" href="{{ yt_stats.channel_url }}" target="_blank" rel="noopener noreferrer">
            ğŸ“º Open in YouTube
          </a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

<script>
  function showLoading(elementId) {
    const loadingEl = document.getElementById(elementId);
    if (loadingEl) {
      loadingEl.style.display = 'block';
    }
  }
</script>
{% endblock %}
