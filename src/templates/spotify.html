{% extends 'main.html' %}
{% block title %}Spotify & YouTube Artist Metrics{% endblock %}
{% block content %}
<div class="advanced-search-link-wrapper">
  <a href="/search" class="advanced-search-link">Try Advanced Search üîç</a>
</div>
<div class="main-flex">
  <div class="container search-box">
    <h1>Spotify</h1>
    <form action="/" method="post">
      <input name="artist_name" placeholder="Artist Name" autocomplete="off" required aria-label="Artist name search">
      <button type="submit" name="action" value="spotify">Search</button>
    </form>
    {% if artist %}
      <div class="artist-card">
        {% if artist.image_url %}
          <img class="artist-img" src="{{ artist.image_url }}" alt="Image of {{ artist.name }}">
        {% endif %}
        <div class="artist-name">{{ artist.name }}</div>
        <div class="artist-info"><strong>Followers:</strong> {{ artist.followers }}</div>
        <div class="artist-info"><strong>Popularity:</strong> {{ artist.popularity }}/100</div>
        {% if artist.genres %}
          <div class="artist-info"><strong>Genres:</strong> {{ artist.genres }}</div>
        {% endif %}
        {% if artist.spotify_url %}
          <a class="artist-link" href="{{ artist.spotify_url }}" target="_blank" rel="noopener noreferrer">View on Spotify</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
  <div class="container search-box">
    <h1 class="youtube-title">YouTube</h1>
    <form method="post" action="/">
      <input type="text" name="channel_name" placeholder="YouTube Channel Name" required aria-label="YouTube channel name search">
      <button type="submit" name="action" value="youtube">Search</button>
    </form>
    {% if yt_stats %}
      <div class="artist-card">
        {% if yt_stats.image_url %}
          <img class="artist-img" src="{{ yt_stats.image_url }}" alt="Image of channel {{ yt_stats.title }}">
        {% endif %}
        <div class="artist-name">{{ yt_stats.title }}</div>
        {% if yt_stats.description %}
          <div class="artist-info artist-description">{{ yt_stats.description[:150] }}{% if yt_stats.description|length > 150 %}...{% endif %}</div>
        {% endif %}
        <div class="artist-info"><strong>Subscribers:</strong> {{ yt_stats.subscribers }}</div>
        <div class="artist-info"><strong>Total Views:</strong> {{ yt_stats.views }}</div>
        <div class="artist-info"><strong>Videos:</strong> {{ yt_stats.video_count }}</div>
        {% if yt_stats.top_video_title %}
          <div class="top-video-section">
            <div class="artist-info top-video-label"><strong>üî• Most Viewed:</strong></div>
            <div class="artist-info top-video-title">{{ yt_stats.top_video_title[:60] }}{% if yt_stats.top_video_title|length > 60 %}...{% endif %}</div>
            {% if yt_stats.top_video_views %}
              <div class="artist-info"><strong>Views:</strong> {{ yt_stats.top_video_views }}</div>
            {% endif %}
            {% if yt_stats.top_video_url %}
              <a class="artist-link" href="{{ yt_stats.top_video_url }}" target="_blank" rel="noopener noreferrer">Watch Video</a>
            {% endif %}
          </div>
        {% endif %}
        {% if yt_stats.channel_url %}
          <a class="artist-link" href="{{ yt_stats.channel_url }}" target="_blank" rel="noopener noreferrer">View on YouTube</a>
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>
{% if artist or yt_stats %}
<div class="clear-btn-row">
  <form method="post" action="/">
    <button type="submit" name="action" value="clear" class="clear-btn">Clear Results</button>
  </form>
</div>
{% endif %}
{% endblock %}
